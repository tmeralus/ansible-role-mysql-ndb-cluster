- name: Download and Extract Mysql Cluster binaries
  unarchive:
    src: "http://dev.mysql.com/get/Downloads/MySQL-Cluster-7.3/mysql-cluster-gpl-7.3.4-linux-glibc2.5-x86_64.tar.gz"
    dest: /var/tmp/
    remote_src: yes
  become: true

- name: Extract binaries
  command: tar -C /var/tmp -xzf /var/tmp/mysql-cluster/.tar.gz
  args:
    creates: /var/tmp/mysql-cluster/
  become: true

- name: Install nbd binaries
  command: install ndb_mgmd ndb_mgm /usr/local/bin/
  args:
    chdir: "/var/tmp/mysql-cluster-gpl-7.3.4-linux-glibc2.5-x86_64/bin"
    creates: /usr/local/bin/ndb_mgmd
  become: true

- name: Install init file
  copy:
    src: ndb_mgmd.init
    dest: /etc/init.d/ndb_mgmd
  become: true

- name: Activate init file
  service:
    name: ndb_mgmd
    enabled: yes
  become: true

- name: Create data dir
  file:
    path: /var/lib/mysql-cluster
    state: directory
  # mode: 0644
  become: true

- name: Copy config
  template:
    src: config.ini
    dest: /var/lib/mysql-cluster/config.ini
  become: true

#- name: Initialize ndb_mgmd
#  command: ndb_mgmd -f /var/lib/mysql-cluster/config.ini --initial --config-dir=/var/lib/mysql-cluster/
#  args:
#    creates: /var/lib/mysql-cluster/ndb_1_cluster.log
#  become: true
