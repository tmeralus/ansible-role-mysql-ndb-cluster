- name: Download and Extract Mysql Data Cluster binaries
  unarchive:
    src: "http://dev.mysql.com/get/Downloads/MySQL-Cluster-7.3/mysql-cluster-gpl-7.3.4-linux-glibc2.5-x86_64.tar.gz"
    dest: /var/tmp/
    remote_src: yes
  become: true

- name: Install nbd binaries
  command: install /var/tmp/mysql-cluster-gpl-7.3.4-linux-glibc2.5-x86_64/bin/ndbd /usr/local/bin/ndbd
  args:
    creates: /usr/local/bin/ndbd
  become: true

- name: Install config
  template:
    src: my.cnf
    dest: /etc/my.cnf
  become: true

- name: Install init file
  copy:
    src: ndbd.init
    dest: /etc/init.d/ndbd
  become: true

- name: Activate init file
  service:
    name: ndbd
    enabled: yes
  become: true

- name: Initialize ndbd
  command: "/usr/local/mysql/bin/ndbd --initial"
  args:
    creates: /usr/local/mysql/data/ndbinfo/
  become: true
